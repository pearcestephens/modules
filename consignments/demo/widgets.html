<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Consignments Demo Widgets</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <style>
    body{padding:20px;background:#f8fafc}
    .card{box-shadow:0 4px 12px rgba(0,0,0,.06)}
    code{background:#f1f5f9;padding:2px 4px;border-radius:4px}
  </style>
</head>
<body>
  <h1 class="mb-4">Consignments – Demo Widgets</h1>

  <!-- Evidence Upload Widget -->
  <div class="card mb-4">
    <div class="card-header">Evidence Upload</div>
    <div class="card-body">
      <form id="evidenceForm" enctype="multipart/form-data">
        <div class="form-row">
          <div class="col-md-3 mb-2"><input class="form-control" name="transfer_id" placeholder="Transfer ID" value="999201"></div>
          <div class="col-md-6 mb-2"><input class="form-control-file" type="file" name="file1"></div>
          <div class="col-md-3 mb-2"><button class="btn btn-primary btn-block" type="submit">Upload</button></div>
        </div>
      </form>
      <pre id="evidenceOut" class="mt-3"></pre>
    </div>
  </div>

  <!-- Store Summary Widget -->
  <div class="card mb-4">
    <div class="card-header">Store Summary / Notifications</div>
    <div class="card-body">
      <form id="summaryForm">
        <div class="form-row">
          <div class="col-md-3 mb-2"><input class="form-control" name="transfer_id" placeholder="Transfer ID" value="999201"></div>
          <div class="col-md-9 mb-2"><input class="form-control" name="note" placeholder="Summary note"></div>
        </div>
        <button class="btn btn-primary" type="submit">Record Summary</button>
      </form>
      <pre id="summaryOut" class="mt-3"></pre>
    </div>
  </div>

  <!-- Rate Compare Widget (demo) -->
  <div class="card mb-4">
    <div class="card-header">Rate Compare (2 carriers)</div>
    <div class="card-body">
      <div class="form-row">
        <div class="col-md-3 mb-2"><input class="form-control" id="fromOutlet" placeholder="From Outlet" value="main-warehouse"></div>
        <div class="col-md-3 mb-2"><input class="form-control" id="toOutlet" placeholder="To Outlet" value="outlet-001"></div>
        <div class="col-md-3 mb-2"><input class="form-control" id="boxes" placeholder="# Boxes" value="3"></div>
        <div class="col-md-3 mb-2"><button class="btn btn-secondary btn-block" id="getRates">Compare</button></div>
      </div>
      <div id="ratesOut" class="mt-2"></div>
    </div>
  </div>

  <!-- Label Creation Widget (demo) -->
  <div class="card mb-4">
    <div class="card-header">Label Creation (manual or API)</div>
    <div class="card-body">
      <div class="form-row">
        <div class="col-md-3 mb-2"><input class="form-control" id="transferIdLabel" placeholder="Transfer ID" value="999201"></div>
        <div class="col-md-3 mb-2"><input class="form-control" id="trackingManual" placeholder="Manual Tracking (opt)"></div>
        <div class="col-md-3 mb-2"><select class="form-control" id="carrier"><option value="nzpost">NZ Post</option><option value="gss">GSS</option></select></div>
        <div class="col-md-3 mb-2"><button class="btn btn-success btn-block" id="createLabel">Create/Attach</button></div>
      </div>
      <pre id="labelOut" class="mt-2"></pre>
    </div>
  </div>

  <script>
    document.getElementById('evidenceForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const res = await fetch('../api/evidence_upload.php', { method:'POST', body: fd });
      document.getElementById('evidenceOut').textContent = await res.text();
    });

    document.getElementById('summaryForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const form = new FormData(e.target);
      const payload = { transfer_id: parseInt(form.get('transfer_id')), note: form.get('note') };
      const res = await fetch('../api/store_summary.php', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
      document.getElementById('summaryOut').textContent = await res.text();
    });

    document.getElementById('getRates').addEventListener('click', (e)=>{
      e.preventDefault();
      const boxes = parseInt(document.getElementById('boxes').value||'3');
      // Demo-only rates
      const rates = [
        { carrier:'nzpost', service:'standard', price: 8.50, eta:'2-3 days'},
        { carrier:'gss', service:'economy', price: 7.90, eta:'3-4 days'}
      ];
      const best = rates.reduce((a,b)=> a.price<b.price?a:b);
      document.getElementById('ratesOut').innerHTML = `
        <div class="alert alert-info">Best price: <strong>${best.carrier.toUpperCase()}</strong> ${best.service} — $${best.price.toFixed(2)} (ETA ${best.eta}) for ${boxes} boxes</div>`;
    });

    document.getElementById('createLabel').addEventListener('click', (e)=>{
      e.preventDefault();
      const tracking = document.getElementById('trackingManual').value.trim();
      const carrier = document.getElementById('carrier').value;
      if (tracking) {
        document.getElementById('labelOut').textContent = JSON.stringify({success:true, mode:'manual', tracking}, null, 2);
      } else {
        // Demo API response
        const tn = (carrier==='nzpost'?'NZ':'GSS') + Math.floor(Math.random()*1e10);
        document.getElementById('labelOut').textContent = JSON.stringify({success:true, mode:'api', carrier, tracking: tn, label_url:'#'}, null, 2);
      }
    });
  </script>
</body>
</html>
