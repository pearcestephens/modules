# Consignments Module - Controllers

## Overview
Controller classes and methods for the Consignments module, following MVC architecture.

**Last Updated:** 2025-10-12 07:00 UTC

## Base Controllers

### BaseController
**File:** `_shared/lib/Controller/BaseController.php`
```php
abstract class BaseController
```
**Purpose:** Foundation class for all controllers
**Methods:**
- `__construct()` - Initialize controller
- `render()` - Render view with data
- `redirect()` - Handle redirects
- `validateInput()` - Input validation helper

### ApiController  
**File:** `_shared/lib/Controller/ApiController.php`
```php
abstract class ApiController extends BaseController
```
**Purpose:** Base for API endpoint controllers
**Methods:**
- `jsonResponse()` - Standard JSON response format
- `validateCsrf()` - CSRF token validation
- `handleError()` - API error handling

### PageController
**File:** `_shared/lib/Controller/PageController.php`  
```php
abstract class PageController extends BaseController
```
**Purpose:** Base for page rendering controllers
**Methods:**
- `setLayout()` - Set page layout template
- `addAsset()` - Include CSS/JS assets
- `setPageTitle()` - Set page title and meta

## Main Controllers

### PackController
**File:** `transfers/controllers/PackController.php`
```php
final class PackController extends BaseController
```
**Purpose:** Handle pack operations interface
**Methods:**
- `index()` - Display pack interface
- `show($transferId)` - Show specific transfer to pack
- `submit()` - Process pack submission

### ReceiveController
**File:** `transfers/controllers/ReceiveController.php`
```php
final class ReceiveController extends BaseController  
```
**Purpose:** Handle receive operations interface
**Methods:**
- `index()` - Display receive interface
- `show($transferId)` - Show specific transfer to receive
- `submit()` - Process receive submission

### HubController
**File:** `transfers/controllers/HubController.php`
```php
class HubController extends BaseController
```
**Purpose:** Transfer hub dashboard and overview
**Methods:**
- `index()` - Hub dashboard
- `pending()` - Show pending transfers
- `history()` - Transfer history view

### HomeController
**File:** `transfers/controllers/HomeController.php`
```php
final class HomeController extends BaseController
```
**Purpose:** Module home page and navigation
**Methods:**
- `index()` - Module landing page
- `dashboard()` - Quick stats and actions

## API Controllers

### PackApiController
**File:** `transfers/controllers/Api/PackApiController.php`
```php
final class PackApiController extends ApiController
```
**Purpose:** Pack operation API endpoints
**Methods:**
- `addLine()` - Add product line to pack
- `updateQuantity()` - Update line quantities
- `submitPack()` - Submit completed pack
- `lockPack()` - Lock/unlock pack for editing

### ReceiveApiController  
**File:** `transfers/controllers/Api/ReceiveApiController.php`
```php
final class ReceiveApiController extends ApiController
```
**Purpose:** Receive operation API endpoints
**Methods:**
- `addLine()` - Add product line to receive
- `updateQuantity()` - Update received quantities
- `submitReceive()` - Submit completed receive
- `validateReceive()` - Validate receive data

## Controller Dependencies
- **Database:** Uses CIS query builder for data access
- **Validation:** Shared validation library
- **Session:** CIS session management
- **Logging:** Error and audit logging
- **CSRF:** Token-based protection for forms/APIs

## Error Handling
All controllers implement standardized error handling:
- Page controllers: Redirect with flash messages
- API controllers: JSON error responses
- Database errors: Logged and sanitized for display

## Authentication
Controllers check authentication via:
- Session validation in constructor
- Role-based access control
- CSRF protection for state-changing operations

---
*Generated by CIS Knowledge Base System*
